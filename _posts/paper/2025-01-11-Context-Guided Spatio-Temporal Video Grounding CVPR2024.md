---
layout: post
title: 'Context-Guided Spatio-Temporal Video Grounding CVPR2024'
subtitle: '文本引导的时空视频定位'
date: 2025-01-11
author: Sun
cover: 'https://pic1.imgdb.cn/item/6781f7b9d0e0a243d4f3426c.png'
tags: 论文阅读
---

> [文本引导的时空视频定位](https://openaccess.thecvf.com/CVPR2024)
> 1中国科学院大学，北京，中国 2美国北德克萨斯大学计算机科学与工程系，登顿，美国 3中国科学院软件研究所，北京，中国

# 1.文章针对痛点

这篇文章仍然关注的是时空视频定位任务。

这篇文章考虑的问题是，现有的方法经常是使用给定的文本描述作为检索视频对象的唯一线索，但是来自文本的对象信息往往不足，因此导致现有方法很容易受到视频干扰或者物体外观变化的影响，从而导致模型在复杂的场景中会出现性能退化。

为了缓解这个问题，常见的做法是通过包含更细粒度的文本描述来增强文本查询。但是这种方式存在着明显的问题，首先是这需要为所有的对象重建更长更详细的文本查询，这个工作是费力昂贵的；其次，更长的文本查询会导致训练和推理更多的计算开销；最后，尽管具有文本查询在这种情况下可以增强，但是它很难全面的描述具体的视觉细节。因此，这种方式也是不合适的。

# 2.主要贡献

因此，为了解决上述问题，同时不产生其他的问题。本文提出了一个新的架构，文本引导的*STVG，CG-STVG*；该方法从视频中挖掘对象的判别性实例上下文信息，并将这些信息作为目标定位的补充引导。

该方法的关键包含两个模块。一个是**实例上下文信息生成*instance context generation (ICG)***，另一个是**实例上下文信息细化*instance context refinement (ICR)***。其中，前者是关注从视频中<mark>发现实例的视觉上下文信息</mark>；简单来说，*ICG* 首先会估计前景的潜在区域，然后使用它们从视觉特征中提取外观和动作的上下文信息。后者目的是<mark>消除前者得到的上下文信息中不相关或者有害的信息</mark>，简单来说，它采用基于时间和空间相关性得分的联合时空滤波方法来抑制不相关的特征。

原文总结贡献如下：

1. 引入了 *CG-STVG*，这是一种新颖而简单的方法，通过从视频中挖掘实例视觉上下文来指导目标定位，从而改进 *STVG*。
2. 提出了一个实例上下文生成模块 (*ICG* ) 来发现对象的视觉上下文信息。
3. 提出了一个实例上下文细化 (*ICR* ) 模块，通过消除不相关的上下文特征来改进对象的上下文，从而大大提高了性能。
4. 在包括 *HCSTVG-v1/-v2* 和 *VidSTG* 在内的三个基准测试上进行的大量实验中，*CG-STVG* 创造了新的最高水平，展示了其有效性。

# 3.实现流程

还是先看一下整体的架构图![整体的架构图](https://pic1.imgdb.cn/item/6780f8afd0e0a243d4f313aa.png)
不论是时序动作检测还是时空视频定位，目前大部分方法都是基于DETR的方法，即编码器-解码器的结构。这篇文章也不例外，也是编码器-解码器的结构，但是值得注意的是，<mark>这篇文章在提取视频特征的时候，使用了两个backbone，按照文章描述，其中2D的提取外观信息（如颜色、形状等），3D提取的是运动信息（如速度、轨迹等）</mark>。主要创建还是集中在解码过程。

下面还是简单介绍一下这篇文章方法的实现流程：

1. 提取特征：和其他所有方法一样，第一步都是先提取视觉和文本特征；这里需要特别注意的是，视频特征使用了两个backbone提取。
2. 融合视觉文本特征：与其他方法一样在获取多模态特征后，对这些特征进行融合。
3. 解码：这个解码涉及到了多个解码阶段，每个阶段的基本模块大体上是一样的，包含四个部分，除了第一个阶段输入可能不太一样。
4. 生成预测的事件管道和分类标签：获取了对应的解码内容后，经过特定的预测头，获得最终的预测结果。

# 4.实现细节

* **多模态融合**：多模态融合比较简单，就是将提取到的三个特征投影到相同的通道数，之后进行连接操作，连接之后，在这个基础上加了一个位置编码和类型编码，最后经过一个自注意力编码器得到编码器最后的输出。
* **上下文引导的解码器**：这个就是解码阶段的基础组件，包含四个部分，分别是<mark>空间解码块SDB、实例上下文生成模块ICG、实例上下文细化模块ICR、时间解码模块TDB</mark>。空间解码块的大致过程用公式表示如下（其中，第一阶段比较特殊，公式表示如下）；ICG和ICR模块后面会详细介绍；时间解码模块的大致过程用公式表示如下，<mark>需要注意的是，在这个模块并没有使用实例上下文相关内容</mark>（据文章描述，当使用这个内容的时候，模型效果并不好，所以在该模块就没有使用）。

$$
\begin{aligned}
\mathcal{Q}_{k} & =\mathrm{SDB}_{k}(\mathcal{Q}_{k-1},\mathcal{C}_{k-1},\tilde{\mathcal{X}}) \\
 & =\mathrm{CA}(\mathrm{CA}(\mathrm{SA}(\mathcal{Q}_{k-1}),\mathcal{C}_{k-1}),\tilde{\mathcal{X}})
\end{aligned}
$$

$$
{\mathcal{Q}}_{1}=\mathrm{SDB}_{1}({\mathcal{Q}}_{0},\tilde{\mathcal{X}})=\mathrm{CA}(\mathrm{SA}({\mathcal{Q}}_{0}),\tilde{\mathcal{X}})
$$

$$
\mathcal{P}_{k}=\mathrm{TDB}_{k}(\mathcal{P}_{k-1},\tilde{\mathcal{X}})=\mathrm{MLP}(\mathrm{CA}(\mathrm{SA}(\mathcal{P}_{k-1}),\tilde{\mathcal{X}}))
$$

* **ICG模块**：该模块使用空间查询特征$\mathcal{Q}_{k}$，发现潜在前景特征（也就是实例上下文）。更直观的理解是，在这个解码过程中，$\mathcal{Q}_{k}$逐渐从目标中学习到越来越多的位置信息，因此能够被用于发现目标区域，从而被用于进一步挖掘对象特征。具体来说，该模块会先利用一个MLP，将特征$\mathcal{Q}_{k}$转换成前景区域（如下公式1）；第二步提取外观和运动特征，并将他们转换成2D特征；最后提取上下文特征（如下2）。

$$
\mathcal{R}_{k}=\operatorname{MLP}\left(\mathcal{Q}_{k}\right)=\left\{r_{i}^{k}\right\}_{i=1}^{N_{v}} （1）
$$

$$
\mathcal{C}_{k}^{a}=\operatorname{RoIAlign}\left(\tilde{\mathcal{X}}_{a}^{2 d}, \mathcal{R}_{k}\right) \quad \mathcal{C}_{k}^{m}=\operatorname{RoIAlign}\left(\tilde{\mathcal{X}}_{m}^{2 d}, \mathcal{R}_{k}\right) （2）
$$

* **ICR模块**：这个模块考虑到上一步得到的实例上下文信息可能是具有噪声的，甚至具有有害的特征，为了解决这个问题，从而引入了细化模块。**具体来说**，文章在 ICR 中引入了一种两级时空联合细化机制。在第一级中，实例上下文通过时间过滤器细化，具有每个特征的时间置信度。然后，在第二级，设计一个空间过滤器来抑制不相关的特征。**时间细化**是通过计算置信度分数，利用解码阶段 k 中的时间查询特征 $\mathcal{P}_{k}$来计算与对象相关的每个帧的置信度得分(计算公式如下1)，分数越高，则认为越相关；因此，根据该置信度分数，去除掉分数较低的内容（去除公式如下2）。空间细化也是与上面类似，也是计算置信度分数。（过程公式表示如下3 4）

$$
s_k^t=\mathrm{Sigmoid}(\mathrm{MLP}(\mathcal{P}_k)) （1）
$$

$$
\mathcal{C}_k^{a,t}=\mathrm{HF}_\mathbf{t}(\mathcal{C}_k^a,s_k^t,\theta^t)\quad\mathcal{C}_k^{m,t}=\mathrm{HF}_\mathbf{t}(\mathcal{C}_k^m,s_k^t,\theta^t) （2）
$$

$$
s_k^s=(\mathsf{Sigmoid}(\mathsf{MLP}(\mathcal{C}_k^a))+\mathsf{Sigmoid}(\mathsf{MLP}(\mathcal{C}_k^m)))/2 （3）
$$

$$
\mathcal{C}_k^{a,ts}=\mathrm{HF}_\mathbf{s}(\mathcal{C}_k^{a,t},s_k^s,\theta^s)\quad\mathcal{C}_k^{m,ts}=\mathrm{HF}_\mathbf{s}(\mathcal{C}_k^{m,t},s_k^s,\theta^s) （4）
$$

ICG和ICR模块的流程图如下：![ICG和ICR模块的流程图](https://pic1.imgdb.cn/item/67810799d0e0a243d4f316e7.png)

# 5.模型性能


# 6.改进/挑战/问题

这篇文章感觉解码设计还是比较复杂的。

