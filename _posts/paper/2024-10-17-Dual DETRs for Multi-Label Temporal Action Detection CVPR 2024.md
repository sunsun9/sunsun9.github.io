---
layout: post
title: 'Dual DETRs for Multi-Label Temporal Action Detection CVPR 2024'
subtitle: 'Dual DETRs：多标记时序动作检测'
date: 2024-10-17
author: Sun
cover: 'https://pic.imgdb.cn/item/670b8d21d29ded1a8ce52859.png'
tags: 论文阅读
---

> [Dual DETRs: 多标签时序动作检测](https://openaccess.thecvf.com/CVPR2024)

> 这篇文章主要是在DETR的基础上，加入了对次优问题的分析。DETR是在实例级上进行目标检测，而本文通过得到次优问题边界，加入了对边界级的探讨。因次，本文设计了一个双支结构DualDETR，从实例级和边界级并行进行，实现最终的目标检测。
> 
> 主要设计就是提出了双支结构，并基于双支结构提出了双支查询解码结构。因为有两个查询，因此考虑查询对齐；查询对齐也有利于后面的互补细化。同时查询涉及到初始化问题，DETR采用的查询方式是随机初始化查询，而本文则考虑利用编码器得到的*proposals*初始化查询，让查询获取一定的先验知识。

# 摘要

[时序动作检测*(TAD)*](#001)目的是从未剪裁的视频中识别动作边界和对应类别。由于[*DETR*](#002)在目标检测上的成功，目前有很多方法采取将基于查询的架构用于*TAD*任务中；但是这些方法都主要遵循在实例级别预测动作（即通过[中心点识别](#003)每个动作），容易导致边界定位不理想的情况。

考虑到这个问题，本文提出了一种双层基于查询的*TAD*架构，*DualDERT*，从实例级和边界级两个层次来检测动作。由于在不同层次的解码需要不同粒度的语义，因此本文引入了一个双支解码结构，这种结构为不同层次构建了独特的解码过程，有助于在每个层次上明确捕获时间线索和语义。

此外，基于这种双支结构涉及，本文还提出了一种联合查询初始化策略，来对齐来自两个层次的查询。具体来说，**1）**利用编码器提议以一对一的方式匹配来自每个层次的查询；**2）**然后使用匹配动作提议中的位置和内容先验，来初始化匹配的查询。对齐的双层查询能够在后续编码过程中使用互补线索优化匹配提议。

> 解释

<a id="001">**时序动作检测(*Temporal Action Detection, TAD*)**</a>：需要解决的问题主要有两方面：1）识别动作的开始、结束时间。2）识别动作对应的类别。

<a id="002">***DETR***</a>：是一种基于*Transformer*的目标检测模型，全称是  ***End-to-End Object Detection with Transformers***，处理的是图像目标检测（即得到目标边框和目标类别）。*DETR*引入了*Transformer*架构，用于解决目标检测任务，将目标检测问题重新表述为集成查询与图像特征之间关系的序列预测问题。使用一组稀疏的可学习的解码查询，直接预测动作而无需NMS后处理。主要特点有：1）使用的*Transformer*结构，并引入了查询机制。2）与传统的目标检测不同，*DETR*是一种端到端的结构。3）使用 *Hungarian* 匹配算法，将查询与检测结果进行对齐。

注：在*DETR*中，查询是一组可学习的向量，**每个查询代表一个潜在的目标物体**。查询的数量往往是固定的，且不需要与真实的目标物体数量对齐，在模型驯良刚开始的时候，这些查询向量往往是随机初始化的。

<a id="003">**中心点识别**</a>：指通过聚焦人体或物体的某个关键点中心，，来分析和识别整体动作或行为。**1）**动作识别可以通过分析身体其他部位相对于中心点的运动轨迹来完成。**2）**通过将其他关键点的位置、速度和加速度信息都转换为相对于中心点的坐标，可以减少特征维度并减少计算复杂度。**3）**中心点识别策略能够有效地应对身体其他部位位置误差和抖动，减少噪声影响，特别是当身体其他部分的动作与整体姿态关系密切时。

# 引言

本文关注的是复杂的多标签时序动作检测*（Multi-label TAD）*，即有来自不同类别的动作共存于未修剪视频中，并且经常伴随着显著的时间重叠。

现在的一些方法都遵循*DETR*的基于查询的检测流程，使用一组稀疏的可学习的解码查询，直接预测动作而无需*NMS*后处理；通过中心点来识别动作和基于偏移量来预测持续时间。虽然这种方法能有效捕捉动作重要的语义帧，但是忽略了目标定位和动作分类两个任务的差别（目标定位主要通过他的质心来判断，而视频中的动作往往通过起始和结束边界来定义）。因此，这些方法在**动作边界精确定位**上表现不足。

为了解决这个问题，本文提出了一种基于查询的双支*TAD*结构，将实例级和边界级建模集成到动作解码中。*instance-level*捕获*proposal*的重要语义帧，提供动作内容的整体理解；*bodundary-level*关注*proposal*边界周围的细节，对显著的边界帧有更高的敏感性。*DualDETR*能够改善*action proposals*，通过结合*instance-level*的可靠识别和*boundary-level*的精确边界细化。

通过一个解码器简单的解码两个层次的查询效果不好，因为两个层次的解码往往需要不同粒度的语义；使用一个解码器解码不能有效关注每个层次的特殊语义。**所以，本文提出了使用双支解码结构**，这种分离有助于明确捕获每个层次各自的特征。特征分离也使得每个层次上的每个动作的明确线索可以得到保留，并且在不同的特征图上处理，有助于重叠动作的准确定位。

基于这种双支结构，本文还提出了一个新的联合查询初始化阶段，来对齐来自不同层次的查询，并实现*action proposals*的[互补细化](#004)。有两个特点：1）对编码器预测的action proposals构建对齐，每一个*action proposal*都是开始边界查询、结束边界查询和实例查询对。2）每一个查询都是作为一个位置和内容向量对构建。位置和内容向量被初始化，用来自他们匹配的*proposals*的位置和语义先验。位置查询向量能够引导查询明确关注匹配的*proposal*，内容向量能为成对关系建模和全局特征细化提供语义指导。

原文过程图如下：![解码架构图](https://pic.imgdb.cn/item/670ccda3d29ded1a8cd74f5c.png)

> 这篇文章的想要解决的问题主要是，在*DETR*的基础上找到了目标检测的次优答案—动作边界。所以在*DETR*使用实例级检测的基础上，加入了边界级检测。
> 
> 基于此，本文提出了双层查询动作检测（对应上面的想法）。根据双层查询架构，本文认为需要使用双支解码；此外，还提出联合查询初始化来对齐查询。

<a id="004">**互补细化**</a>：我的理解是*instance-level*重点关注的是动作的关键内容，因次对于动作的开始和结束边界并没有很准确；而*boundary-level*重点关注的是动作的开始和结束边界，因此并不了解动作的内容是什么。

# 相关工作

本文从三个方向讲述了相关工作，分别是多标签TAD、在TAD中的边界信息和在DETR中的查询公式。

在边界信息中提到的一些方法解释：

**时间*ROI*对齐**：指在时间维度上对不同时间段的感兴趣区域（*Region of Interest，ROI*）进行对齐或配准。例如，两个视频中可能包含相同的动作，但该动作在不同视频中的发生时间和持续时间不同。因此，在时间轴上对这些不同时刻的*ROI*进行对齐，使得相似的事件在不同时间序列中被同步处理或比较。

**边界池化**：在标准的池化操作中，边界区域的处理可能会带来一些问题，如边界信息的丢失或被忽略，而**边界池化技术**的目的是通过**特定的策略处理图像或特征图的边界信息**，保留边缘信息并确保池化过程中的信息不丢失，从而提高模型对边缘信息的感知能力。例如，镜像填充、边界扩展等技术。

# 方法

## 初步工作

**基于查询的TAD框架**：*DETR*采用*transformer*结构，有编码器和解码器组成。使用一个预先训练好的视频编码器，提取视频特征。编码器采用自注意力来建模片段级时间关系，之后使用LE编码器细化。解码器使用*Nq*个动作查询，同时使用自注意力建模动作级关系并使用交叉注意力细化全局特征。随后，将检测头应用于这些动作查询以获得稀疏检测结果，而无需使用非最大抑制 (*NMS*) 等后处理技术。

**可变形注意力**：是为了解决*DETR*收敛缓慢的问题，同时提高计算效率。在本文，将可变形注意力作为一个明确定指导注意力定位的工具。

## 概述

*DualDETR*的目的是预测一组动作实例。从总体图中可以看到，**编码过程**：先由一个训练好的特征提取器提取视频特征，嵌入位置信息后，经过一个特征编码器，这个特征编码器使用的是一个具有可变形注意力的*transformer*编码器，能在片段级有效执行时间建模。**解码过程**：引入了一种基于 *Transformer *解码器的双分支解码结构，从边界和实例级别预测动作。同时，为了实现两个级别的*proposals*的互补细化，提出了一种联合查询初始化策略，根据从编码器预测的动作*proposals*对不同的查询组进行对齐。 每个*proposals*都与一对边界查询和一个实例查询匹配。查询的内容和位置向量由匹配*proposals*的特征嵌入和边界位置对应初始化。在每一层的末尾，相互改进模块促进了对齐查询之间的通信。最后，实例级内容向量生成的分类分数以及相互改进模块中的提议作为最终的检测结果，而无需进行*NMS*后处理。

**双层查询构建**：将每个查询构建为一对位置和内容向量。实例级查询组包含内容矩阵和位置矩阵，其中内容向量可以捕获高层语义信息，而位置向量包含两个归一标量（一个*proposal*的中心和持续时间）。类似地，边界级查询组包含内容矩阵和位置矩阵，其中位置向量包含归一化标量（一个*proposal*的开始和结束时间）。

**联合初始化查询对齐**：在构建查询后，需要对齐两个组的查询，以便于对动作*proposals*的联合细化。为了实现对齐，**1）**本文首先通过一个应用于*encoder feature map*的检测头来获取*proposal&classification scores*；**2）**通过*classification scores*选定*proposals*，与来自两个组的解码器查询进行匹配。此匹配过程确保实例查询和边界查询之间一一对齐，从而允许它们在解码过程中联合更新匹配的提议。**基于匹配，本文提出了联合初始化**。为查询对齐提供良好的启动，并进一步将查询与其匹配的提议对齐。

原文查询对齐&联合初始化图如下：
![查询对齐&联合初始化](https://pic.imgdb.cn/item/670e2d25d29ded1a8c036302.png)

**双支解码**：在解码之前，将*encoder feature map*划分成实例级和边界级（包含开始边界和结束边界特征）两部分。

1. **边界层解码**：边界级解码器层将边界级特征图、内容查询向量以及位置查询向量作为输入。在自注意力步骤之后，使用可变形交叉注意力来关注*proposal*边界。具体来说，使用边界向量作为参考点，可变形注意力关注每个参考点周围的一小组关键采样点。
   1）内容向量更新如下：![内容向量更新](https://pic.imgdb.cn/item/670e3325d29ded1a8c09ccdf.png)
   2）对更新后的内容向量应用回归，得到偏移量*∆s*和*∆e*。
   3）根据*∆s*和*∆e*，细化更新位置向量。
   ![位置向量更新](https://pic.imgdb.cn/item/670e33f5d29ded1a8c0ab793.png)
2. **实例层解码**：与边界层解码类似。![实例层-内容向量更新](https://pic.imgdb.cn/item/670e3eb0d29ded1a8c193241.png)
   ![实例层-位置向量更新](https://pic.imgdb.cn/item/670e3f16d29ded1a8c19ac3f.png)
3. **互补细化**：在细化两个层次的解码查询后，引入了人一个互补细化模型，通过利用匹配的查询来实现*proposals*的互补细化。
   1）利用边界位置细化实例级的位置向量。![互补细化-实例级位置更新](https://pic.imgdb.cn/item/670e3feed29ded1a8c1a9ac9.png)
   类似地，细化边界位置。
   ![互补细化-边界级位置更新](https://pic.imgdb.cn/item/670e4048d29ded1a8c1b05e7.png)

原文总结构图如下：![网络总体图](https://pic.imgdb.cn/item/670e2079d29ded1a8cf735ba.png)

# 实验

本文使用了三个数据集进行实验，分别是MultiTHUMOS、Charades以及TSU。

**消融实验**：1）首先测试了双支结构设计的有效性。实验结果图如下：![双支结构消融实验](https://pic.imgdb.cn/item/67106f12d29ded1a8cc06dd9.png)
2）查询初始化的消融实验。与两种方法以及随机初始化进行了比较。实验结果图如下：![查询初始化消融实验](https://pic.imgdb.cn/item/671070f9d29ded1a8cc299d9.png)
3）互补细化的消融实验。实验结果图如下：![互补细化消融实验](https://pic.imgdb.cn/item/671071a4d29ded1a8cc34344.png)

